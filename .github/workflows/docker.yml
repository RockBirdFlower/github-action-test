name: Docker CI/CD

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'

jobs:
  docker-build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Docker ë©”íƒ€ë°ì´í„° ì„¤ì •
      id: meta
      uses: docker/metadata-action@v4
      with:
        images: myapp
        tags: |
          type=ref,event=branch
          type=semver,pattern={{version}}
          type=sha
    
    - name: Docker ì´ë¯¸ì§€ ë¹Œë“œ
      run: |
        echo "ğŸ³ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì¤‘..."
        echo "íƒœê·¸: ${{ steps.meta.outputs.tags }}"
        echo "âœ… ì´ë¯¸ì§€ ë¹Œë“œ ì™„ë£Œ"
    
    - name: ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸
      run: |
        echo "ì»¨í…Œì´ë„ˆ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘..."
        npm test
    
    # - name: Docker Hubì— í‘¸ì‹œ (ì‹¤ì œ ì‚¬ìš©ì‹œ ì£¼ì„ í•´ì œ)
    #   uses: docker/login-action@v2
    #   with:
    #     username: ${{ secrets.DOCKERHUB_USERNAME }}
    #     password: ${{ secrets.DOCKERHUB_TOKEN }}
    
    # - name: ì´ë¯¸ì§€ í‘¸ì‹œ
    #   run: docker push ${{ steps.meta.outputs.tags }}
