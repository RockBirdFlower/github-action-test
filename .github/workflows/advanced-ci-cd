name: CI/CD - ê³ ê¸‰ íŒŒì´í”„ë¼ì¸

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # Job 1: ì½”ë“œ í’ˆì§ˆ ê²€ì‚¬
  lint:
    name: ì½”ë“œ ë¦°íŠ¸ ê²€ì‚¬
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ì½”ë“œ ìŠ¤íƒ€ì¼ í™•ì¸
      run: |
        echo "ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ ì¤‘..."
        echo "âœ… ì½”ë“œ ìŠ¤íƒ€ì¼ ê²€ì‚¬ ì™„ë£Œ"

  # Job 2: í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì—¬ëŸ¬ Node ë²„ì „)
  test:
    name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    runs-on: ${{ matrix.os }}
    
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]
        node-version: [16, 18, 20]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Node.js ${{ matrix.node-version }} ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
    
    - name: í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      run: npm test

  # Job 3: ë¹Œë“œ
  build:
    name: ë¹Œë“œ
    runs-on: ubuntu-latest
    needs: [lint, test]
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Node.js ì„¤ì •
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: ë¹Œë“œ ì‹¤í–‰
      run: |
        echo "ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ ì¤‘..."
        npm start
        echo "âœ… ë¹Œë“œ ì™„ë£Œ"
    
    - name: ë¹Œë“œ ê²°ê³¼ ì—…ë¡œë“œ
      uses: actions/upload-artifact@v4
      with:
        name: build-artifacts
        path: |
          index.js
          package.json

  # Job 4: ë°°í¬ (main ë¸Œëœì¹˜ì—ë§Œ)
  deploy:
    name: ë°°í¬
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' && github.event_name == 'push'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: ë¹Œë“œ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ
      uses: actions/download-artifact@v4
      with:
        name: build-artifacts
    
    - name: ë°°í¬ ì‹œë®¬ë ˆì´ì…˜
      run: |
        echo "ğŸš€ ë°°í¬ ì‹œì‘..."
        echo "ì„œë²„: production-server.example.com"
        echo "í™˜ê²½: Production"
        echo "âœ… ë°°í¬ ì™„ë£Œ!"
    
    - name: ë°°í¬ ì•Œë¦¼
      run: |
        echo "ğŸ“¢ ë°°í¬ ì•Œë¦¼ ì „ì†¡"
        echo "ì»¤ë°‹: ${{ github.sha }}"
        echo "ì‘ì„±ì: ${{ github.actor }}"
